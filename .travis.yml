language: generic

before_install:
- export PATH=$HOME/.local/bin:$PATH
- travis_retry curl -L https://github.com/TokTok/hs-tools/releases/download/v0.3/hs-tools-v0.3.tar.gz | tar xz -C $HOME

install:
- mkdir -p ~/rust-installer ~/rust
- curl -sL https://static.rust-lang.org/rustup.sh -o ~/rust-installer/rustup.sh
- sh ~/rust-installer/rustup.sh --prefix=~/rust --spec=stable -y --disable-sudo 2> /dev/null
- export PATH=$PATH:$HOME/rust/bin
- gem install mdl

script:
- make
- make check
- make format
# Check that make format was executed before submitting.
- git diff --exit-code
# Check that hs-toxcore was updated.
- git clone --depth=1 https://github.com/TokTok/hs-toxcore ../hs-toxcore
- (cd ../hs-toxcore && make doc)
- git diff --exit-code
